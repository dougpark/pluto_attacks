<!doctype html>
<html lang="en">
    <head>

        <meta charset="UTF-8" />
        <title>Scale Test</title>
        <link rel="icon" type="image/png" href="/images/povingames-icon-512.png" /> 
        <link rel="apple-touch-icon" href="/images/povingames-icon-512.png" /> 
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black" />
        <meta name="viewport" content="initial-scale=1 maximum-scale=1 user-scalable=0" />
        <style>
            html {margin: 0px; padding: 0px}
            body {margin: 0px; padding: 0px}
            @font-face {
                font-family: HappyKiller;
                src: url('HappyKiller.ttf') format('truetype');
            }
            body {
                margin: 0px;
                padding: 0px;
                font-family: 'HappyKiller', 'arial', 'sans-serif';
                font-size: 14px;
                background-color: #000000;
                color: #0099ff;
            }
        </style>
    </head>
    <body>
        <main id="game"></main>   
        <script src="lib/phaser.2.6.2.min.js" type="text/javascript"></script> 
        <script src="js/Povin.js"></script>  
     

        <script>
            // Phaser current version test environment
            // Progress bars - health bar example

            var getWidth = function() {
                var width = window.innerWidth
                || document.documentElement.clientWidth
                || document.body.clientWidth;
                width = width * window.devicePixelRatio;
                return width;
            }
            
            var getHeight = function() {
                var height = window.innerHeight
                || document.documentElement.clientHeight
                || document.body.clientHeight;
                height = height * window.devicePixelRatio;
                return height;
            }

            var game = new Phaser.Game(getWidth(), getHeight(), Phaser.AUTO, 'test');

            var BasicGame = function(game) {};

            BasicGame.Boot = function (game) {
                // nothing here
                
            };

            BasicGame.Boot.prototype = 
            {
                init: function() {
                    // initialize the Povin object
                    Povin.game = game;

                    

                    this.physics.startSystem(Phaser.Physics.ARCADE);
                    //this.scale.scaleMode = Phaser.ScaleManager.SHOW_ALL;
                    this.scale.scaleMode = Phaser.ScaleManager.RESIZE;
                    
                    
                    this.scale.setMinMax(400, 300, 800, 600);
                    this.scale.pageAlignHorizontally = true;
                    this.scale.pageAlignVertically = true;
                    

                },

                preload: function() {
                    game.time.advancedTiming = true;

                    
                    game.scale.setResizeCallback(function() {
                        var width = this.getWidth();
                        var height = this.getHeight();
                        //console.log('size: ' + width + ', ' + height);
                        this.game.camera.setSize(width, height);
                        this.game.renderer.resize(width, height);
                        this.game.scale.setMaximum();
                        this.game.scale.refresh();
                        Povin.resized = true;
                    });
                    
                },

                create: function() 
                {
                    this.graphics = game.add.graphics(0, 0);
                   
                    // just a property we can tween so the bar has a progress to show
                    this.barProgress = 128;
                    
                    // the bar itself
                    this.bar = this.add.bitmapData(256, 32);
                    
                    this.barSprite = game.add.sprite(0,0, this.bar);
                    Povin.place(this.barSprite,.5,.5,(-this.bar.width * 0.5),0);

                    game.add.tween(this).to({barProgress: 0}, 3000, null, true, 0, Infinity);
               
                    this.one();

                    this.fill = "#FF0000";

                    
               }, 

               one: function () {
                    //  Top Center
                    this.tString = 'top center ';
                    this.tText = game.add.text(0,0, this.tString, { font: '16px arial', fill: '#0099ff', align: 'center' });
                    this.tText.anchor.setTo(0.5, 0.5);
                    Povin.place(this.tText,0.5,0.1);

                    //  Bottom Center
                    this.tString2 = 'bottom center ';
                    this.tText2 = game.add.text(0,0, this.tString2, { font: '16px arial', fill: '#0099ff', align: 'center' });
                    this.tText2.anchor.setTo(0.5, 0.5);
                    Povin.place(this.tText2,0.5,0.9);

                    //  Left Center
                    this.tString3 = 'left center ';
                    this.tText3 = game.add.text(0,0, this.tString3, { font: '16px arial', fill: '#0099ff', align: 'center' });
                    this.tText3.anchor.setTo(0.5, 0.5);
                    Povin.place(this.tText3,0.1,0.5);

                    //  right Center
                    this.tString4 = 'right center ';
                    this.tText4 = game.add.text(0,0, this.tString4, { font: '16px arial', fill: '#0099ff', align: 'center' });
                    this.tText4.anchor.setTo(0.5, 0.5);
                    Povin.place(this.tText4,0.9,0.5);
                    

               },

               checkResize: function() {

                if (Povin.resized) {
                    Povin.resized = false;

                    // place items here to adjust for resize
                    Povin.place(this.barSprite,.5,.5,(-this.bar.width * 0.5),0);

                    Povin.place(this.tText,0.5,0.1);
                    Povin.place(this.tText2,0.5,0.9);
                    Povin.place(this.tText3,0.1,0.5);
                    Povin.place(this.tText4,0.9,0.5);

                }

               },

              

                update: function() {

                    // check if screen has been resized
                    this.checkResize();

                    this.graphics.clear();

                    this.graphics.lineStyle(0);
                    this.graphics.beginFill("0xfff", 1);
                    this.graphics.drawCircle(this.game.world.centerX, this.game.world.centerY, 100);
                    this.graphics.endFill();

                    this.graphics.lineStyle(20, 0x0000FF, 1);
                    this.graphics.drawRect(0,0,game.width, game.height);


                    // ensure you clear the context each time you update it or the bar will draw on top of itself
                    this.bar.context.clearRect(0, 0, this.bar.width, this.bar.height);
                    
                    // some simple colour changing to make it look like a health bar
                    if (this.barProgress < 32) {
                    this.fill = '#ff0000';   
                    }
                    else if (this.barProgress < 64) {
                        this.fill = '#ffff00';
                    }
                    else {
                        this.fill = '#00ff00';
                    }
                    this.bar.context.fillStyle = this.fill;
                    
                    // draw the bar
                    this.bar.context.fillRect(0, 0, this.barProgress, 32);
                    //this.barSprite.x = game.world.centerX - (this.bar.width * 0.5);
                    //this.barSprite.y = game.world.centerY;
                    
                    // important - without this line, the context will never be updated on the GPU when using webGL
                    this.bar.dirty = true;
                },
                render: function()
                {
                    Povin.debugFps(20);
                    Povin.debugText('devicepixelratio= ' +  window.devicePixelRatio,40);
                    Povin.debugText('isPortrait= ' +  this.scale.isGamePortrait,60);
                    Povin.debugText('screenOrientation= ' +  this.scale.screenOrientation,80);
                    Povin.debugText('sourceAspectRatio= ' +  this.scale.sourceAspectRatio,100);
                    //Povin.debugSprite(this.barSprite);  
                    //Povin.debugText('barProgress= ' + this.barProgress); 
                    //Povin.debugText("Phaser " + Phaser.VERSION + " " + ['AUTO', 'CANVAS', 'WEBGL', 'HEADLESS', 'WEBGL_MULTI'][this.game.renderType], 10, 540, 'white', 'arial');
                    //Povin.debugText("width= "+this.game.width + " height= " + this.game.height);
                }
            };

            game.state.add('Boot', BasicGame.Boot);
            game.state.start('Boot');
        </script>
</body>
</html>